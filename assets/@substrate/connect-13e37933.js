const T="modulepreload",B=function(e){return"/polkadot-staking-dashboard/"+e},S={},w=function(r,n,c){if(!n||n.length===0)return r();const h=document.getElementsByTagName("link");return Promise.all(n.map(t=>{if(t=B(t),t in S)return;S[t]=!0;const o=t.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!c)for(let i=h.length-1;i>=0;i--){const l=h[i];if(l.href===t&&(!o||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${t}"]${a}`))return;const d=document.createElement("link");if(d.rel=o?"stylesheet":T,o||(d.as="script",d.crossOrigin=""),d.href=t,document.head.appendChild(d),o)return new Promise((i,l)=>{d.addEventListener("load",i),d.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${t}`)))})})).then(()=>r()).catch(t=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=t,window.dispatchEvent(o),!o.defaultPrevented)throw t})};var L;(function(e){e.polkadot="polkadot",e.ksmcc3="ksmcc3",e.rococo_v2_2="rococo_v2_2",e.westend2="westend2"})(L||(L={}));let k;async function A(e){if(!Object.keys(L).includes(e))throw new Error("Invalid chain name");return k||(k={polkadot:w(()=>import("../polkadot-0adb95e9.js"),[]),ksmcc3:w(()=>import("../ksmcc3-069295be.js"),[]),westend2:w(()=>import("../westend2-3fc4acee.js"),[]),rococo_v2_2:w(()=>import("../rococo_v2_2-5d521168.js"),[])}),(await k[e]).chainSpec}class P extends Error{constructor(){super(),this.name="AlreadyDestroyedError"}}class _ extends Error{constructor(r){super(r),this.name="CrashError"}}class C extends Error{constructor(){super(),this.name="JsonRpcDisabledError"}}const F=![typeof window,typeof document].includes("undefined");let J=class{},g=null;const N=()=>g||(g=w(()=>import("../index-browser-ac1bab27.js"),["assets/index-browser-ac1bab27.js","assets/no-auto-bytecode-browser-05314b7c.js"]).then(e=>(J=e.QueueFullError,e.start)),g);let b=null;const U=()=>b||(b=w(()=>import("../no-auto-bytecode-browser-05314b7c.js"),[]).then(e=>e.startWithBytecode),b),p=[];let u=null,m=3;const D=e=>{if(e.maxLogLevel&&e.maxLogLevel>m&&(m=e.maxLogLevel),u)return p.push(e),u instanceof Promise?u:Promise.resolve(u);let r,n;if(e.workerFactory){r=e.workerFactory();const{port1:t,port2:o}=new MessageChannel;r.postMessage(t,[t]),n=o}const c={portToWorker:n,forbidTcp:!0,forbidNonLocalWs:!0,maxLogLevel:9999999,cpuRateLimit:.5,logCallback:(t,o,a)=>{t>m||(t<=1?console.error("[%s] %s",o,a):t===2?console.warn("[%s] %s",o,a):t===3?console.info("[%s] %s",o,a):t===4?console.debug("[%s] %s",o,a):console.trace("[%s] %s",o,a))}},h=r?U().then(t=>t({...c,bytecode:new Promise(o=>{F?r.onmessage=a=>o(a.data):r.on("message",a=>o(a))})})):N().then(t=>t(c));return u=h,h.then(t=>(u===h?u=t:t.terminate(),t)),p.push(e),u},R=e=>{const r=p.indexOf(e);if(r===-1)throw new Error("Internal error within smoldot");p.splice(r,1),m=3;for(const n of p.values())n.maxLogLevel&&n.maxLogLevel>m&&(m=n.maxLogLevel);p.length===0&&(u&&!(u instanceof Promise)&&u.terminate(),u=null)},O=e=>{try{e()}catch(r){const n=r;throw(n==null?void 0:n.name)==="JsonRpcDisabledError"?new C:(n==null?void 0:n.name)==="CrashError"?new _(n.message):(n==null?void 0:n.name)==="AlreadyDestroyedError"?new P:new _(r instanceof Error?r.message:`Unexpected error ${r}`)}},V=e=>{const r=e||{maxLogLevel:3},n=new Map,c=async(t,o,a,s)=>{var d;const i=await D(r);try{const l=await i.addChain({chainSpec:t,potentialRelayChains:(d=a==null?void 0:a.map(f=>n.get(f)).filter(f=>!!f))!==null&&d!==void 0?d:[...n.values()],disableJsonRpc:o===void 0,databaseContent:s});(async()=>{for(;;){let f;try{f=await l.nextJsonRpcResponse()}catch{break}try{o(f)}catch(v){console.error("JSON-RPC callback has thrown an exception:",v)}}})();const y={sendJsonRpc:f=>{O(()=>{try{l.sendJsonRpc(f)}catch(v){if(v instanceof J)try{const I=JSON.parse(f);o(JSON.stringify({jsonrpc:"v2",id:I.id,error:{code:-32e3,message:"JSON-RPC server is too busy"}}))}catch{}else throw v}})},remove:()=>{try{O(()=>{l.remove()})}finally{n.delete(y),R(r)}}};return n.set(y,l),y}catch(l){throw R(r),l}};return{addChain:c,addWellKnownChain:async(t,o,a)=>{D(r);try{return await c(await A(t),o,void 0,a)}finally{R(r)}}}},x=new Map;typeof window=="object"&&window.addEventListener("message",({data:e})=>{var r;(e==null?void 0:e.origin)==="substrate-connect-extension"&&((r=x.get(e.chainId))===null||r===void 0||r(e))});function $(){const e=new BigUint64Array(2);return crypto.getRandomValues(e),(e[1]<<BigInt(64)|e[0]).toString(36)}const W=()=>{const e=new Map,r=async(n,c,h,t=[])=>{let o;const a=new Promise(i=>{o=()=>i(null)}),s={id:$(),state:{state:"pending",waitFinished:o}};if(x.has(s.id))throw new Error("Unexpectedly randomly generated the same chain ID twice despite 64bits of entropy");if(x.set(s.id,i=>{switch(s.state.state){case"pending":{const l=s.state.waitFinished;switch(i.type){case"chain-ready":{s.state={state:"ok"};break}case"error":{s.state={state:"dead",error:new _("Error while creating the chain: "+i.errorMessage)};break}default:console.warn("Unexpected message of type `msg.type` received from substrate-connect extension")}l();break}case"ok":{switch(i.type){case"error":{s.state={state:"dead",error:new _("Extension has killed the chain: "+i.errorMessage)};break}case"rpc":{h?h(i.jsonRpcMessage):console.warn("Unexpected message of type `msg.type` received from substrate-connect extension");break}default:console.warn("Unexpected message of type `msg.type` received from substrate-connect extension")}break}}}),E(n?{origin:"substrate-connect-client",chainId:s.id,type:"add-well-known-chain",chainName:c}:{origin:"substrate-connect-client",chainId:s.id,type:"add-chain",chainSpec:c,potentialRelayChainIds:t}),await a,n&&s.state.state==="dead"){let i;const l=new Promise(y=>{i=()=>y(null)});s.state={state:"pending",waitFinished:i},E({origin:"substrate-connect-client",chainId:s.id,type:"add-chain",chainSpec:await A(c),potentialRelayChainIds:[]}),await l}if(s.state.state==="dead")throw s.state.error;const d={sendJsonRpc:i=>{if(s.state.state==="dead")throw s.state.error;if(!h)throw new C;E({origin:"substrate-connect-client",chainId:s.id,type:"rpc",jsonRpcMessage:i})},remove:()=>{if(s.state.state==="dead")throw s.state.error;s.state={state:"dead",error:new P},x.delete(s.id),e.delete(d),E({origin:"substrate-connect-client",chainId:s.id,type:"remove-chain"})}};return e.set(d,s.id),d};return{addChain:(n,c)=>r(!1,n,c,[...e.values()]),addWellKnownChain:(n,c)=>r(!0,n,c)}};function E(e){window.postMessage(e,"*")}const j="substrateConnectExtensionAvailable",M=typeof document=="object"&&typeof document.getElementById=="function"&&!!document.getElementById(j);function q(e){return!(e==null?void 0:e.forceEmbeddedNode)&&M?W():V(e==null?void 0:e.embeddedNodeConfig)}const Q=Object.freeze(Object.defineProperty({__proto__:null,AlreadyDestroyedError:P,CrashError:_,JsonRpcDisabledError:C,get WellKnownChain(){return L},createScClient:q,isExtensionPresent:M},Symbol.toStringTag,{value:"Module"}));export{w as _,Q as i};
